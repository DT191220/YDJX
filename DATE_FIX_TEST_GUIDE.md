# 报名日期时区问题修复测试指南

## 问题描述
学员报名日期字段在保存和显示时出现时区偏移，导致保存的日期比输入的日期早一天。

## 修复内容
修改了后端 `server/src/routes/students.ts` 文件中的两处查询：

### 1. 学员列表查询 (第106-117行)
使用 `DATE_FORMAT()` 函数格式化日期字段：
```sql
DATE_FORMAT(birth_date, '%Y-%m-%d') as birth_date
DATE_FORMAT(enrollment_date, '%Y-%m-%d') as enrollment_date
```

### 2. 单个学员详情查询 (第144-156行)
同样使用 `DATE_FORMAT()` 函数格式化日期字段

## 测试步骤

### 前置条件
1. 确保后端服务器已重启（端口3001）
2. 确保前端服务器正常运行
3. 确保数据库连接正常

### 测试场景

#### 场景1：新建学员时保存报名日期
1. 访问"学员录入与查询"页面
2. 点击"新增学员"按钮
3. 填写学员信息，在"报名日期"字段输入 `2026-01-18`
4. 填写其他必填字段（姓名、身份证号、手机号、性别等）
5. 点击"保存"按钮
6. **预期结果**：保存成功后，刷新页面，在学员列表中查看该学员，报名日期应显示为 `2026-01-18`

#### 场景2：编辑学员时修改报名日期
1. 在学员列表中点击某个学员的"编辑"按钮
2. 检查"报名日期"字段是否正确显示之前保存的日期（如 `2026-01-18`）
3. 修改报名日期为 `2026-01-19`
4. 点击"保存"按钮
5. **预期结果**：保存成功后，关闭弹窗再次点击"编辑"，报名日期应显示为 `2026-01-19`

#### 场景3：验证出生日期字段
1. 新建或编辑学员时，检查"出生日期"字段（从身份证号自动提取）
2. **预期结果**：出生日期应与身份证号中的日期信息完全一致，无时区偏移

## 验证要点

### API 响应格式
- 学员列表 API (`GET /api/students`)：
  ```json
  {
    "enrollment_date": "2026-01-18",  // 纯字符串格式，无时间戳
    "birth_date": "1997-01-19"
  }
  ```

- 学员详情 API (`GET /api/students/:id`)：
  ```json
  {
    "enrollment_date": "2026-01-18",  // 纯字符串格式，无时间戳
    "birth_date": "1997-01-19"
  }
  ```

### 注意事项
- 如果仍出现日期偏移，请检查：
  1. 后端服务器是否已重启并加载最新代码
  2. 浏览器控制台网络请求中 API 返回的日期格式
  3. 数据库中 `students` 表的 `enrollment_date` 和 `birth_date` 字段值

## 技术原理
- **问题根源**：MySQL DATE 类型通过 mysql2 驱动返回时会自动转换为 ISO 8601 时间戳（如 `2026-01-18T00:00:00.000Z`），Node.js 按 UTC 时区解析，前端接收到后因时区差异（+8小时）导致日期显示偏移
- **解决方案**：使用 `DATE_FORMAT()` 函数在数据库层面将日期格式化为字符串，避免驱动层的时区转换

## 测试记录

### 测试环境
- 后端端口：3001
- 前端端口：[待填写]
- 数据库：MySQL
- 测试日期：2026-01-18

### 测试结果
请在实际测试后填写：

| 场景 | 输入日期 | 保存后显示 | 是否通过 | 备注 |
|------|---------|-----------|---------|------|
| 新建学员 | 2026-01-18 | [待测试] | [ ] | |
| 编辑学员 | 2026-01-19 | [待测试] | [ ] | |
| 出生日期 | [自动提取] | [待测试] | [ ] | |

---
生成时间：2026-01-18
修复版本：v1.0
